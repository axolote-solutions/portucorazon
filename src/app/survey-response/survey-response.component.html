<form [formGroup]="surveyForm" (ngSubmit)="onSubmit()">
    <section class="page-section ">
        <div class="container">

            <mat-horizontal-stepper [linear]="true" #stepper labelPosition="bottom" formArrayName="sectionsResponses"
                (selectionChange)="selectionChange($event)">
                <mat-step *ngFor="let sectionResponse of sectionsResponses().controls; let s = index"
                    [stepControl]="sectionResponse" [formGroupName]="s" [editable]="!sectionResponse.valid">
                    <ng-template matStepLabel>{{survey.sections[s].name}}</ng-template>

                    <div class="personal" formArrayName="questionResponses" style="border-color: black;">

                        <blockquote class="blockquote text-center">
                            <p class="pb-5 pt-3">{{survey.sections[s].title}}</p>
                        </blockquote>

                        <div *ngFor="let questionResponse of questionResponses(s).controls; let q = index"
                            [formGroupName]="q" class="section">

                            <div [ngSwitch]="survey.sections[s].questions[q].questionType">

                                <div *ngSwitchCase="'OPEN'">
                                    <div ng-Show="survey.sections[s].questions[q].display" class="question">
                                        <div class="question-header">
                                            <label>{{survey.sections[s].questions[q].questionText}}</label>
                                        </div>
                                        <div *ngIf="survey.sections[s].questions[q].openQuestionConfig && 
                                                survey.sections[s].questions[q].openQuestionConfig.maxLength; 
                                                    else elseBlock" class="pl-3">
                                            <mat-form-field fxFlex="30" appearance="outline">
                                                <mat-label>{{survey.sections[s].questions[q].questionText}}</mat-label>
                                                <input matInput #input maxlength={{survey.sections[s].questions[q].openQuestionConfig.maxLength}} formControlName="responseText">
                                            </mat-form-field>
                                        </div>
                                        <ng-template #elseBlock>
                                            <div class="pl-3">
                                                <mat-form-field fxFlex="30" appearance="standard">
                                                    <mat-label>{{survey.sections[s].questions[q].questionText}}
                                                    </mat-label>
                                                    <input matInput formControlName="responseText">
                                                </mat-form-field>
                                            </div>
                                        </ng-template>
                                        <div *ngIf="questionResponse.get('responseText').invalid && (
                                            questionResponse.get('responseText').touched || questionResponse.get('responseText').dirty || submitted )"
                                            class="alert alert-danger pl-3">
                                            <div *ngIf="questionResponse.get('responseText').errors.required">
                                                Este campo es obligatorio.
                                            </div>
                                            <div *ngIf="questionResponse.get('responseText').errors.email">
                                                Introduzca un email válido.
                                            </div>
                                            <div *ngIf="questionResponse.get('responseText').errors.pattern">
                                                Introduzca un solo números.
                                            </div>
                                            <div *ngIf="questionResponse.get('responseText').errors.min">
                                                Los valores mínimo/máximo son
                                                {{survey.sections[s].questions[q].openQuestionConfig.minValue}}/{{survey.sections[s].questions[q].openQuestionConfig.maxValue}}.
                                            </div>
                                            <div *ngIf="questionResponse.get('responseText').errors.max">
                                                Los valores mínimo/máximo son
                                                {{survey.sections[s].questions[q].openQuestionConfig.minValue}}/{{survey.sections[s].questions[q].openQuestionConfig.maxValue}}.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div *ngSwitchCase="'SELECT'">
                                    <div ng-Show="survey.sections[s].questions[q].display" class="question">
                                        <div class="question-header">
                                            <label>{{survey.sections[s].questions[q].questionText}}</label>
                                        </div>
                                        <div class="pl-3">
                                            <mat-form-field fxFlex="80">
                                                <mat-select formControlName="responseOption">
                                                    <mat-option
                                                        *ngFor="let option of survey.sections[s].questions[q].options"
                                                        [value]="option">{{option.text}}</mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                        <div *ngIf="questionResponse.get('responseOption').invalid && (
                                            questionResponse.get('responseOption').touched || submitted )"
                                            class="alert alert-danger pl-3">
                                            <div *ngIf="questionResponse.get('responseOption').errors.required">
                                                Este campo es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div *ngSwitchCase="'OPTION'">
                                    <div [hidden]="!survey.sections[s].questions[q].display" class="question">
                                        <div class="question-header">
                                            <label>{{survey.sections[s].questions[q].questionText}}</label>
                                        </div>
                                        <div class="pl-3">
                                            <mat-radio-group class="example-radio-group"
                                                formControlName="responseOption">
                                                <mat-radio-button class="example-radio-button"
                                                    *ngFor="let option of survey.sections[s].questions[q].options"
                                                    [value]="option" (change)="radioChange($event, s, q)">
                                                    {{option.text}}
                                                </mat-radio-button>
                                            </mat-radio-group>
                                        </div>
                                        <div *ngIf="questionResponse.get('responseOption').invalid && (
                                                questionResponse.get('responseOption').touched || submitted)"
                                            class="alert alert-danger pl-3">
                                            <div *ngIf="questionResponse.get('responseOption').errors.required">
                                                Este campo es obligatorio
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="sectionResponse.invalid && submitted" class="alert alert-danger pl-3">
                        <div>
                            Aún quedan preguntas sin responder.
                        </div>
                    </div>

                    <div class="btns">

                        <div class="container">
                            <div *ngIf="survey.sections[s].footerMessage">
                                <div class="pt-4" [innerHtml]="survey.sections[s].footerMessage | safe: 'html'"></div>
                            </div>
                        </div>
                        <div style="padding-top:20px;">
                            <button type="submit" class="boton boton-info" mat-button matStepperNext>
                                <span class="material-icons prefix">
                                    arrow_forward
                                </span>
                            </button>
                        </div>

                    </div>

                </mat-step>
                <mat-step [completed]=true>
                    <ng-template matStepLabel>Finalizar</ng-template>
                    <br><br><br>
                    <div class="survey-end">¡Gracias por sus respuestas!</div>
                    <br>
                    <br>
                    <br>
                    <p> <b>RECOMENDACIONES</b></p>
                    <p>1. Haz ejercicio físico un mínimo de tres veces por semana, mantente activo, camina, olvida el ascensor, baja una parada antes de autobús antes. No te quedes en el sofá.</p>
                    <p>2. Mantén un peso equilibrado.</p>
                    <p>3. Cuida tu alimentación, añade a tu dieta más vegetales frescos y menos grasa. Disminuye la ingesta de sal.</p>
                    <p>4. Modera consumo de alcohol, como máximo una copa de vino diaria. No fumes.</p>
                    <p>5. Controla los niveles de glucosa, presión arterial y de colesterol en tus chequeos de salud.</p>
                    <p>6. Si eres diabético o hipertenso, lleva un control de las cifras de glucosa y de presión arteria, sigue las recomendaciones de tu profesional de salud.</p>
                    <p>7. Lleva una vida mas tranquila, con menos estrés. Aprende a relajarte a respirar con calma. Revitaliza los problemas del día a día.</p>
                    <p>8. Educa a tus hijos en la adquisición de hábitos saludables,les estarás educando en salud.</p>
                    <p>9. Mantén una vida social. Comunicate con tus amigos. Es bueno sentirse acompañado.</p>
                    <p>10. confía en tu profesional de la salud y sigue sus recomendaciones. Aprende a cuidarte y a cuidar tu corazón.</p>
                    <div>
                        <button class="boton boton-info" mat-raised-button type="button" [disabled]="!surveyForm.valid"
                            (click)="saveSurvey()">Finalizar</button>
                    </div>
                </mat-step>
            </mat-horizontal-stepper>

        </div>
        <br><br>
           <div class="logo"> 
              <img class="img" src="./assets/img/logoLarbas.jpg"hspace="20"/>
          </div>
    </section>
</form>

<pre>{{ surveyForm.value | json }}</pre> 